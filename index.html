
<html>
<head>  <title>个人主页</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />  
    <style type="text/css">
     #num1 img{
         margin-top:-85px;
         margin-left:895px;         
         width:100px;
         height:100px;
         border-width:3px;
         border-style:solid;
         border-color:#FFFFFF;
         border-radius:50%;
         position:absolute;
     }
     hr{
         margin-left:900px;
     }
            a{
              font-family:Verdana, sans-serif;
              text-decoration: none;
              color:	#6495ED;
              padding: 5px;
              background-color:black;
              /*border-radius: 30px;*/
                          -moz-transition: all 0.5s ease 0s;   /*按钮渐变*/
             -webkit-transition:all 0.5s ease 0s;              /*按钮渐变*/
              transition:all 0.5s ease 0s;                     /*按钮渐变*/
               -o-transition:all 0.5s ease 0s;                 /*按钮渐变*/
               
           }
           a:hover,a:active{
            /*background-color:#e2e0e1;*/
            /*color:	#8B5742;*/
            color:white;
            
           }

          body,html{background-image:url(背景2.jpg);/*背景尺寸1919x607*/
                 background-repeat:no-repeat;  /*铺满*/
                 /*background-attachment:fixed;*/ /*背景位置相对屏幕不变*/
                 background-color:#F2F2F2;
                 scroll-behavior:smooth;  /*平滑移动*/
                  
            }
            nav{
              height:50px;
              width:100%;
              background-color:black;
              margin-top:-45px;
              color:white;
              margin-left:-9px;
              position:fixed;
               z-index:999;
              transition:all 0.5s cubic-bezier(.42, 0, .58, 1);
              opacity:0.5;
              
              
             
          }
          nav:hover{
             margin-top:-8px;
             background-color:black;
             opacity:1;
             
          }

          div#num1{
            margin-top:220px;  /*距离顶部px*/
          position:absolute;
           }

           #num1 span{
              margin-left:850px;
              font-family:Baskerville;
              /*font-style:italic;*/
              
           }
           #num1 hr{
               margin-top:-20px;
           }

           #num1 h2{
               font-size:300%;
           }
        div#num2{
            position:absolute;
            margin-top:694px;
           margin-left:775px;
        font-size:120%;
        position:absolute;
        

        }
         ul{
           
           width:50px;
         margin-left:1200px;
           display:inline;
           font-size:14px;
           font-weight:600; /*字体加粗*/
           list-style:none; /*去除左边的标志*/
           
           
        }
               ul li{
                  
                  border-width:2px;
                  /*border-color:#e2e0e1;*/
                  border-color:black;
                   display:inline;
                  top:50px;
                  line-height:48px;
                  margin-left:50px;
                  font-weight:20px;
        
        }

    
        div#num3 {
            background-image:url(声波.jpg);
            margin-top:1000px;
            position:absolute;
            background-size:100% 100%;
            width:50%;
            height:70%;
            border-radius:40px;
            margin-left:480px;
            /*background-attachment: fixed;*/
           /*transition:all 1.5s ease 0s;*/
          
        }

        #num3 span h1 font{
            margin-left:870px;
        }
        #num3 span{
            
            
            box-shadow:2px 4px 6px 0px;
            display:none;
            width:700px;
            height:450px; 
            margin-left:125px;
            margin-top:100px;
            /*background-color:hsla(0, 0%, 100%, .3);*/
            position:relative;
            /*background-attachment: fixed;*/
           
            

        }
        #num3 a{
            display:block;
            margin-left:430px;
            width:100px;
            height:30px;
            text-align:center;
            margin-top:-60px;
             line-height:30px;
             border:2px solid black;
             border-radius:10px;
             color:black;
             background-color:white;
             font-weight:bold;
             
        }
        #num3 a:hover{
            background-color:#6495ED;
            border:2px solid #6495ED;
            color:white;
            
        }
        div#num4
        {
        width:800px;
        height:500px;
        margin-top:1080px;
        margin-left: 550px;
        position:absolute;
        background-color:white;
        opacity:0;
        transition:all 1.5s ease 0s;
        scroll-behavior:smooth;
        font-size:25px;
        }
    


    
        div#num5{
            position:absolute;
            width:100%;
           /* background-color:black;*/
            
            height:50px;
            margin-top:1680px;
             
        }
        #num5 span{
            text-align:center;
            color:black;
            display:block;
            border:2px solid #6495ED;
            border-radius:10px;
            width:200px;
            margin-left:850px;
           
        }
        #num5 span h1{
            font-size:20px;
           
        }
        div#num6{

            width:100%;
            height:500px;
            margin-top:1736px;
            position:absolute;
           /* background-color:black;*/
            
        }
        #num6 span{
            text-align:center;
            display:block;
            color:white;
            width:2px;
            height:750px;
            background-color:black;
            margin-left:950px;
        }
        #num6 div#num7{
                        width:350px;
            height:2px;
            display:block;
            margin-left:600px;
            background-color:black;
            margin-top:-600px;
            
        }
        div#num8{
            width:300px;
            height:300px;
            /*background-color:#6495ED;*/
            position:absolute;
            margin-top:1750px;
            margin-left:300px;
            display:block;
            border-top-left-radius:5%;
            border-bottom-left-radius:5%;
           color:white;
           background: radial-gradient(#6495ED, #38B3E8);
           overflow: hidden;
           word-wrap: break-word;
           word-break: break-all;
           }
div#num9{
    background-color:black;
    width:800px;
    height:2800px;
    margin-top:2800px;
    position:absolute;
    
    margin-left:550px;
}
div#num10{
    background-color:black;
    width:100%;
    height:50px;
    margin-top:900px;
    position:absolute;
    opacity:0;
}
       </style>
               <script type="text/javascript">
               function changeopacity(){
                   var changeopacity1=document.getElementById('num4');
                   /*changeopacity1.style.opacity=x;*/
                   if(changeopacity1.style.opacity='0'){
                      changeopacity1.style.opacity='0.7';
                      
                   }
                    else {
                        changeopacity1.style.opacity='0';
                    }
                   function changeup(){
                       var changeup1=document.getElementById('123');
                       changeup1.marginTop='-20px';
                   }
               }
               window.onload=function(){
                   var olink=document.getElementById("link");
                   olink.onclick=function(){
                           changeopacity();
                          
                           return false;
                   }
               }

   /*            window.onload=function(){
                   var hover3=document.getElementById("123");
                   hover3.hover=function(){
                       hover2();   
                   }}  */
        </script>
</head> 
<body>
<nav ><span style="margin-left:170px;"><big style="font-size:20px"><strong>D I O R</strong></big></span>
<ul><big>
<li><a href='#'>顶部</a></li>
 <li><a href='#num10' >介绍</a></li>
 <li><a href='#num5'>过   程</a></li>
    <li><a href='#c2'>代码</a></li>
   </big></ul></nav>
<div id="num1"style="color:#e2e0e1">
<img src="头像.jpg" style="text-align:center">
    <h1><span  style='text-align:center'>Welcome to </span></h1>
   <h1><span  style="text-align:center">&nbsp;Dior's blog</span></h1><br />
   
   <hr width=5% style="text-align:center"><br/>
<span style="text-align:center;font-size:20px;"> &nbsp;Here's what I want </span>
                   <span style="text-align:center;font-size:20px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to show you </span>   
                   <p style="text-align:center;font-size:20px">Python识别男女声音</p>
    </div>
    <div id="num3">
    <a href='javascript:void(0);' id="link"  onclick="changeup()">简&nbsp;介</a>
    <span><h1 ><font color='black'> 465489
    </font></h1> </span>
    </div>
    <div id="num4">
        ​ &nbsp;&nbsp;人能够很容易的听出说话人的性别，我们能不能让机器也像人一样，听声辨别性别？这个答案是肯定的，特别是随着人工智能算法的发展，识别性能是不断的提升。本实验就是通过声音识别男女性别。类的声音每个人都有自己的特性，例如人类基音的范围约为70～350Hz左右，由于生理结构的不同，男性与女性的声音呈现出不同的听觉特征，男声的基音频率大都在100—200HZ之间，而女声则在200—350HZ之间。主要分为三个部分
        </p>第一是对声音文件进行特征提取
        </p>第二是通过机器学习方法建立男女性别分类模型
        </p>第三则是加载模型进行声音文件测试

    </div>
<div id="num5">
<span id="c1"><h1>过程</h1></span>
</div>
<div id='num6'>
<span ></span>
<div id='num7'></div>  <div id='num7' style="float:right;margin-top:200px;margin-right:601px"></div>
<div id='num7' style="margin-top:400PX"></div>
<div id='num7' style="float:right;margin-top:194px;margin-right:601px"></div>
</div>
<div id="num8"><p style="text-align:center">特征提取</p>核心思想： 最大方差理论，在信号处理中认为信号具有较大的方差，噪声有较小的方差，信噪比就是信号与噪声的方差比，越大越好。因此我们认为，最好的k维特征是将n维样本点变换为k维后，每一维上的样本方差都尽可能的大。
具体思想到推理，给出了一个很好的过程。</p>利用R语言实现，可以使用R语言的warbleR包，使用一个开源的R语言函数包能提取出20个特征，通过脚本处理好的3000多条特征文件，可以直接加载训练模型。


</div>
<div id="num8"style="margin-top:1950px;
margin-left:1300px;
border-top-right-radius:5%;
border-bottom-right-radius:5%;
border-top-left-radius:0%;
border-bottom-left-radius:0%"><p style="text-align:center">机器学习</p>利用xgboost算法，Xgboost是GB算法的高效实现，xgboost算法的步骤首先初始化为一个常数根据一阶导数g和二阶导数h，迭代生成基学习器，相加更新学习器。xgboost考虑了训练数据为稀疏值的情况，可以为缺失值或者指定的值指定分支的默认方向，这能大大提升算法的效率。xgboost 还考虑了当数据量比较大，内存不够时怎么有效的使用磁盘，主要是结合多线程、数据压缩、分片的方法，尽可能的提高算法的效率。</div>
<div id="num8" style="margin-top:2150px"><p style="text-align:center">测试过程</p>正如我们所知，将一段需要测试的男生或女生的声音文件（.wav）输入，进行特征的提取，并且与之前的训练模型进行比较，根据男女生声音特性的不同，例如基因频率，输出结果。</div>
<div id="num8"style="margin-top:2350px;
margin-left:1300px;
border-top-right-radius:5%;
border-bottom-right-radius:5%;
border-top-left-radius:0%;
border-bottom-left-radius:0%"><p style="text-align:center">总结</p>在完成设计实验的过程中，我们深刻意识到自己能力的不足和知识的短浅，有许多代码的问题都需要查找资料才能进行有效的解决，不过在这个过程中让我们学到了很多东西，这让我们非常开心和满足。</div>
<div id="num9" style="background-color:#38B3E8;color:white">
<p style="text-align:center">提取特征</p>
import os</br>
import rpy2.robjects as robjects</br>
from rpy2.robjects import pandas2ri, r</br>
import pandas as pd</br>

os.chdir('C:/Users/TStra/Desktop/signal')</br>

data_list = []</br>

#获取特征文件</br>
def get_feature(fname):</br>
    pandas2ri.activate()</br>
    robjects.r.source('feature_extract.R')      #利用rpy2读取R脚本</br>
    data_read = robjects.r.processFolder(fname) #得到数据文件</br>
    data_read = pandas2ri.ri2py(data_read)      #转化为python可以使用的数据</br>
    return data_read</br>

if __name__ == '__main__':</br>
    file_name_list = os.listdir('data')         #存放.wav格式声音的文件夹</br>
    for file_name in file_name_list:</br>
        data = get_feature(file_name)</br>
        data_list.append(data)</br>
    result = pd.concat(data_list)           </br>
    result['label'] = 'male'</br>
    result.to_csv("male.csv", index=False)</br>
    #result['label'] = 'female'</br>
    #result.to_csv("female.csv", index=False)</br>
    </br>
    <p style="text-align:center">机器学习</p>
    import xgboost as xgb </br>
import pandas as pd</br>
import numpy as np</br>
import sklearn</br>
import pickle</br>
import pprint</br>

def xgb_score(preds, dtrain):</br>
    labels = dtrain.get_label()</br>
    return 'log_loss', sklearn.metrics.log_loss(labels, preds)</br>

input_data = pd.read_csv('C:/Users/TStra/Desktop/signal/voice.csv') #pandas 读取csv文件</br>
input_data = input_data.sample(frac=1) #利用pandas抽样 frac=1 即比例为1</br>
gender = {'male' : 0, 'female' : 1} #性别判断</br>
input_data['label'] = input_data['label'].map(gender) #map函数</br>
cols = [c for c in input_data.columns if c not in ['label']]</br>
print (cols)</br>
train = input_data.iloc[0 :3300]</br>
test = input_data.iloc[3300 : ]</br>
test_label = test['label']</br>
test_label = np.array(test_label).reshape([-1 , 1])</br>
del(test['label'])</br>

fold = 1</br>
for i in range(fold):</br>
    params = {</br>
        'eta': 0.01, #use 0.002</br>
        'max_depth': 5,</br>
        'objective': 'binary:logistic',</br>
        'eval_metric': 'logloss',</br>
        'lambda':0.1,</br>
        'gamma':0.1,</br>
        'seed': i,</br>
        'silent': True</br>
    }</br>
    x1 = train[cols][0:3000]</br>
    x2 = train[cols][3000:]</br>
    y1 = train['label'][0:3000]</br>
    y2 = train['label'][3000 : ]</br>
    watchlist = [(xgb.DMatrix(x1, y1), 'train'), (xgb.DMatrix(x2, y2), 'valid')]</br>
    model = xgb.train(params, xgb.DMatrix(x1, y1), 1500,  watchlist, feval=xgb_score, maximize=False, verbose_eval=50, early_stopping_rounds=50) #use 1500</br>
    if i != 0:</br>
        pred += model.predict(xgb.DMatrix(test[cols]), ntree_limit=model.best_ntree_limit)</br>
    else:</br>
        pred = model.predict(xgb.DMatrix(test[cols]), ntree_limit=model.best_ntree_limit)</br>

pred /= fold</br>
pre_label = np.zeros([pred.shape[0], 1])</br>
for i in range(pred.shape[0]):</br>
    if pred[i] >= 0.5:</br>
        pre_label[i] = 1</br>
    else:</br>
        pre_label[i] = 0</br>

acc = np.mean(np.equal(pre_label, test_label).astype(np.float))</br>
print("the test acc is:", acc)</br>

model_save = open('model.pkl', 'wb')    #保存模型</br>
pickle.dump(model, model_save)</br>
model_save.close()</br>
</br>
<p style="text-align:center">测试过程</p>
import xgboost as xgb</br>
import pandas as pd</br>
import numpy as np</br>
import sklearn</br>
import pickle</br>
import pprint</br>
import rpy2.robjects as robjects</br>
from rpy2.robjects import r, pandas2ri</br>
import os</br>
os.chdir('C:/Users/TStra/Desktop/signal')</br>

#get feature file</br>
def get_feature(fname):</br>
    pandas2ri.activate()</br>
    robjects.r.source('feature_extract.R')</br>
    data_read = robjects.r.processFolder(fname)</br>
    data_read = pandas2ri.ri2py(data_read)</br>
    return data_read</br>

if __name__ == '__main__':</br>
    data_list = []</br>
    model_save = open('model.pkl', 'rb')</br>
    model = pickle.load(model_save)</br>
    model_save.close()</br>

    file_name_list = os.listdir('data')             #读取声音文件</br>
    for file_name in file_name_list:</br>
        data = get_feature(file_name)</br>
        data_list.append(data)</br>
    test = pd.concat(data_list)             #获取wav特征</br>

    pred = model.predict(xgb.DMatrix(test), ntree_limit=model.best_ntree_limit)</br>
    print (pred)</br>
    pre_label = np.zeros([pred.shape[0], 1])</br>
    for i in range(pred.shape[0]):</br>
        if pred[i] >= 0.5:</br>
            pre_label[i] = pred[i]</br>
        else:</br>
            pre_label[i] = pred[i]</br>
    num = 0</br>
    tlen = len(pre_label)</br>
    for i in pre_label:</br>
        num += i</br>
        print ('female is;'+str(num))</br>
        print ('male is:'+str(tlen-num))</br>
        print ((tlen-num)/tlen)</br>
        print (num/tlen)        </br>
</div>
<div id="num10"></div>
<div id="num5" style="margin-top:2700px">
<span id="c2" ><h1>代码</h1></span>
</div>
</body>
</html>
